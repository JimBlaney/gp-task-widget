<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gp-task-widget</title>
    
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="//js.arcgis.com/3.9/js/esri/css/esri.css" />
    
    <style>

      html, body {
        margin: 0; padding: 0;
        width: 100%; height: 100%;
      }

      select:empty {
        display: none;
      }

      .gp-task-name {
        font-weight: bold;
      }

    </style>
    
  </head>
  <body>

    <div class="container">

      <div class="jumbotron">
        <h1>gp-task-widget</h1>
        <p class="lead">
          A set of dojo widgets for dynamically building user interfaces to consume Esri GPTasks
        </p>
      </div>

      <div class="col-sm-4">
        <div data-dojo-type="gptest/dijit/GPServerPicker"></div>
      </div>

      <div class="col-sm-8">
        <div id="map"></div>
      </div>

    </div>
    
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    
    <script>
      var dojoConfig = {
        async: true,
        parseOnLoad: true,
        packages: [
          {
            name: "gp",
            location: location.pathname.replace(/[^\/]+$/, '') + "js/gp"
          },
          {
            name: "gptest",
            location: location.pathname.replace(/[^\/]+$/, '') + "js/gptest"
          }
        ]
      };
    </script>

    <script src="//js.arcgis.com/3.9/"></script>

    <script>
      require([
        "esri/map",
        "esri/toolbars/draw",
        "dojo/on",
        "dojo/topic"
      ], function(
        Map,
        Draw,
        on,
        topic
      ) {

        var map = new Map("map", {
          basemap: "gray"
        });

        var toolbar = new Draw(map);

        topic.subscribe("gp.action.geometry", function(e) {

          console.log("CAPTURING GEOMETRY");

          // TODO: explicit resolution of the geometryType
          toolbar.activate(Draw.POINT);

          var mapClickHandle = on(toolbar, "draw-end", function(ee) {

            mapClickHandle.remove();

            if (!!e.deferred) {
              e.deferred.resolve(ee);
            }

          });

        });

      });
    </script>

  </body>
</html>